# Tools Migration Analysis Report

**Generated by**: /auto-plan
**Source**: docs/migration/old-project/code/app/cong-cu
**Target**: src/app/[locale]/tools
**Date**: 2025-12-06

---

## Exploration Summary

### Tools Discovered

1. **Tính lãi tiền gửi** (Savings Interest Calculator)
   - Location: `/tinh-lai-tien-gui/page.tsx`
   - Purpose: Calculate savings interest with bank comparisons
   - Features: Filtering by amount, period, type; sorting; pagination

2. **Tính toán khoản vay** (Loan Calculator)
   - Location: `/tinh-toan-khoan-vay/page.tsx`
   - Purpose: Calculate loan payments and schedules
   - Features: Monthly payment calculation, interest comparison

3. **Tính lương gross-net** (Gross to Net Calculator)
   - Location: `/tinh-luong-gross-net/page.tsx`
   - Purpose: Calculate net salary from gross
   - Features: Vietnamese tax, insurance deductions

4. **Tính lương net-gross** (Net to Gross Calculator)
   - Location: `/tinh-luong-net-gross/page.tsx`
   - Purpose: Calculate gross salary from net
   - Features: Reverse calculation with tax optimization

### Architecture Patterns

#### Old Implementation
- Client-side rendering with "use client"
- SCSS Modules for styling
- Zustand for state management
- Module-based architecture (`@app/modules/Tools/`)
- API endpoints: `/tools/saving`, `/tools/salary`

#### New Implementation (Current)
- Next.js 13+ App Router
- Tailwind CSS with shadcn/ui
- TypeScript strict mode
- Comprehensive Zustand store
- Responsive design

---

## Requirements Analysis

### Critical Requirements (Must Preserve)

#### 1. Savings Interest Calculator
- **Filter Options**:
  - Amount: 10-1000 million VND
  - Period: 1,3,6,9,12,18,24 months
  - Type: Counter (0) or Online (1)
  - Sort: Ascending/Descending interest rates
- **Features**:
  - Bank comparison table
  - Min/max rate highlighting
  - Pagination
  - External link to open accounts
- **API**: POST `/tools/saving` with `{amount, period, type, orderBy}`

#### 2. Loan Calculator
- Payment calculations
- Amortization schedules
- Interest rate comparisons
- Term length options

#### 3. Salary Converters
- **Vietnamese Tax System**:
  - Progressive tax brackets (7 levels)
  - Social insurance rates
  - Health insurance rates
  - Unemployment insurance rates
- **Regional Allowances**:
  - 4 regional zones
  - Dependent allowances
- **Calculations**:
  - Gross → Net deductions
  - Net → Gross reverse calculation

### Important Requirements

1. **User Tracking**: All interactions must be tracked
2. **Error Handling**: Custom error boundaries
3. **Loading States**: During API calls
4. **Responsive Design**: Mobile and desktop views
5. **Internationalization**: Vietnamese language support

### Nice-to-Have Improvements

1. Enhanced UI with shadcn/ui components
2. Calculation history
3. Comparison features
4. Export functionality
5. Better error messages

---

## Preservation Requirements

### Must Preserve Exactly

1. **Tax Calculation Algorithm**
   ```typescript
   // Progressive tax brackets (Vietnamese law)
   - 0-5M VND: 5%
   - 5M-10M VND: 10%
   - 10M-18M VND: 15%
   - 18M-32M VND: 20%
   - 32M-52M VND: 25%
   - 52M-80M VND: 30%
   - >80M VND: 35%
   ```

2. **Insurance Rates**
   ```typescript
   // Employee rates
   - Social Insurance: 8%
   - Health Insurance: 1.5%
   - Unemployment Insurance: 1%

   // Employer rates
   - Social Insurance: 17.5%
   - Health Insurance: 3%
   - Unemployment Insurance: 1%
   ```

3. **Allowance Amounts**
   ```typescript
   - Self allowance: 11,000,000 VND/month
   - Dependent allowance: 4,400,000 VND/person
   ```

4. **API Contracts**
   - Request/response formats must match
   - All calculation results must be identical

### Can Improve

1. UI/UX with modern components
2. Code organization and types
3. Error handling
4. Performance optimization
5. Test coverage

---

## Technical Migration Strategy

### Phase 1: Foundation (45 min)
1. Create type definitions
2. Set up API client
3. Configure Zustand store
4. Set up routing structure

### Phase 2: Core Logic (2 hours)
1. Migrate calculation functions
2. Implement tax algorithm
3. Add insurance calculations
4. Create validation schemas

### Phase 3: Components (1.5 hours)
1. Create calculator components
2. Implement form interfaces
3. Add result displays
4. Create comparison views

### Phase 4: Integration (1 hour)
1. Connect to API endpoints
2. Implement state management
3. Add error boundaries
4. Set up tracking

### Phase 5: Testing (1 hour)
1. Unit tests for calculations
2. Integration tests
3. E2E tests for flows
4. Cross-browser testing

### Phase 6: Polish (45 min)
1. Accessibility improvements
2. Performance optimization
3. Documentation
4. Deployment prep

---

## Data Models

### ISaving Interface
```typescript
interface ISaving {
  name: string;         // Bank name
  full_name: string;    // Full bank name
  interested: number;   // Interested users count
  ir: number;          // Interest rate
  total: number;       // Total amount
  interest: number;    // Interest earned
  link: string;        // External link
}
```

### ISalary Interface
```typescript
interface ISalary {
  gross: number;
  net: number;
  social_insurance: number;
  health_insurance: number;
  unemployment_insurance: number;
  total_insurance: number;
  family_allowances: number;
  dependent_family_allowances: number;
  taxable_income: number;
  income: number;
  personal_income_tax: number[];
  total_personal_income_tax: number;
  // Additional fields...
}
```

---

## API Integration Points

### Existing Endpoints
1. `POST /tools/saving` - Savings calculations
2. `POST /tools/salary` - Salary conversions
3. Interest rate data feeds

### Migration Considerations
- Preserve exact request/response formats
- Handle authentication if required
- Add error handling
- Consider caching strategies

---

## Risk Assessment

### High Risk
- Tax calculation accuracy (legal implications)
- Insurance rate compliance
- API compatibility

### Medium Risk
- UI/UX changes affecting user experience
- Performance with large datasets
- Mobile responsiveness

### Low Risk
- Code organization improvements
- Additional features
- Documentation updates

---

## Success Criteria

1. All calculations match old system exactly
2. No regressions in functionality
3. Improved performance
4. Better user experience
5. Maintained SEO rankings
6. Zero downtime during migration

---

## Next Steps

1. Create detailed implementation plan
2. Set up development environment
3. Begin with foundation work
4. Test each component thoroughly
5. Gradual rollout with monitoring

---

**Analysis Complete** ✅